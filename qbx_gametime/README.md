# QBX GameTime

Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¸Ð³Ñ€Ð¾Ð²Ð¾Ð³Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð´Ð»Ñ FiveM ÑÐµÑ€Ð²ÐµÑ€Ð° Ñ Ð¿Ñ€Ð¸Ð²ÑÐ·ÐºÐ¾Ð¹ Ðº Ð¼Ð¾ÑÐºÐ¾Ð²ÑÐºÐ¾Ð¼Ñƒ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ (ÐœÐ¡Ðš).

## ÐžÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸

- ðŸ• Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ Ð¼Ð¾ÑÐºÐ¾Ð²ÑÐºÐ¸Ð¼ Ð²Ñ€ÐµÐ¼ÐµÐ½ÐµÐ¼ (UTC+3)
- ðŸ“… 7-Ð´Ð½ÐµÐ²Ð½Ñ‹Ð¹ Ð¸Ð³Ñ€Ð¾Ð²Ð¾Ð¹ Ñ†Ð¸ÐºÐ» (ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ = 205 Ð¼Ð¸Ð½ÑƒÑ‚ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸)
- ðŸŒ¤ï¸ Ð”Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ°Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð¿Ð¾Ð³Ð¾Ð´Ñ‹
- âš¡ï¸ Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ‡ÐµÑ€ÐµÐ· GlobalState (StateBag) Ð±ÐµÐ· Ð»Ð¸ÑˆÐ½Ð¸Ñ… ÑÐµÑ‚ÐµÐ²Ñ‹Ñ… ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹
- ðŸ› ï¸ ÐÐ´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹
- ðŸŒ ÐœÑƒÐ»ÑŒÑ‚Ð¸ÑÐ·Ñ‹Ñ‡Ð½Ð¾ÑÑ‚ÑŒ (RU/EN)
- ðŸ”§ Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Qbox Framework Ð¸ ox_lib

## ÐšÐ°Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸

Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ `GlobalState` Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡Ð¸ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸, Ð´Ð½Ñ Ð½ÐµÐ´ÐµÐ»Ð¸ Ð¸ Ð¿Ð¾Ð³Ð¾Ð´Ñ‹ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°Ð¼. Ð­Ñ‚Ð¾ ÑƒÐ¼ÐµÐ½ÑŒÑˆÐ°ÐµÑ‚ ÑÐµÑ‚ÐµÐ²ÑƒÑŽ Ð½Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ:

```lua
-- Ð¡ÐµÑ€Ð²ÐµÑ€
GlobalState.currentTime = {hour = 12, minute = 30}
GlobalState.weather     = {current = 'CLEAR', next = 'CLOUDS'}

-- ÐšÐ»Ð¸ÐµÐ½Ñ‚
AddStateBagChangeHandler('currentTime', 'global', function(_, _, time) ... end)
```

### Ð Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð´Ð½ÐµÐ¹ Ð½ÐµÐ´ÐµÐ»Ð¸ (ÐœÐ¡Ðš)

| Ð”ÐµÐ½ÑŒ Ð½ÐµÐ´ÐµÐ»Ð¸ | ÐÐ°Ñ‡Ð°Ð»Ð¾ (ÐœÐ¡Ðš) | ÐšÐ¾Ð½ÐµÑ† (ÐœÐ¡Ðš) |
|-------------|--------------|-------------|
| ÐŸÐ¾Ð½ÐµÐ´ÐµÐ»ÑŒÐ½Ð¸Ðº | 06:00 | 09:25 |
| Ð’Ñ‚Ð¾Ñ€Ð½Ð¸Ðº | 09:25 | 12:50 |
| Ð¡Ñ€ÐµÐ´Ð° | 12:50 | 16:15 |
| Ð§ÐµÑ‚Ð²ÐµÑ€Ð³ | 16:15 | 19:40 |
| ÐŸÑÑ‚Ð½Ð¸Ñ†Ð° | 19:40 | 23:05 |
| Ð¡ÑƒÐ±Ð±Ð¾Ñ‚Ð° | 23:05 | 02:30 (+1) |
| Ð’Ð¾ÑÐºÑ€ÐµÑÐµÐ½ÑŒÐµ | 02:30 | 06:00 |

## Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°

1. Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð¿Ð°Ð¿ÐºÑƒ `qbx_gametime` Ð² Ð¿Ð°Ð¿ÐºÑƒ `resources`
2. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð² `server.cfg`:
```
ensure qbx_gametime
```

## ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹

### Ð”Ð»Ñ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð²
- `/time` - ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ñ‚ÐµÐºÑƒÑ‰ÐµÐµ Ð²Ñ€ÐµÐ¼Ñ Ð¸ Ð´ÐµÐ½ÑŒ Ð½ÐµÐ´ÐµÐ»Ð¸

### Ð”Ð»Ñ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð²
- `/settime [Ñ‡Ð°Ñ] [Ð¼Ð¸Ð½ÑƒÑ‚Ð°]` - Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð²Ñ€ÐµÐ¼Ñ
- `/setday [1-7]` - Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð´ÐµÐ½ÑŒ Ð½ÐµÐ´ÐµÐ»Ð¸
- `/freezetime` - Ð—Ð°Ð¼Ð¾Ñ€Ð¾Ð·Ð¸Ñ‚ÑŒ/Ñ€Ð°Ð·Ð¼Ð¾Ñ€Ð¾Ð·Ð¸Ñ‚ÑŒ Ð²Ñ€ÐµÐ¼Ñ
- `/setweather [Ñ‚Ð¸Ð¿]` - Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð³Ð¾Ð´Ñƒ
- `/timemenu` - ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¼ÐµÐ½ÑŽ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð²Ñ€ÐµÐ¼ÐµÐ½ÐµÐ¼

## ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ

ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð½Ð°Ñ…Ð¾Ð´ÑÑ‚ÑÑ Ð² `config/shared.lua`:

```lua
-- Ð”Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð¸Ð³Ñ€Ð¾Ð²Ð¾Ð³Ð¾ Ð´Ð½Ñ Ð² Ð¼Ð¸Ð½ÑƒÑ‚Ð°Ñ…
dayDurationMinutes = 205

-- ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð½ÐµÐ´ÐµÐ»Ð¸ Ð² ÐœÐ¡Ðš
weekStartHourMSK = 6
weekStartMinuteMSK = 0

-- Ð§Ð°ÑÐ¾Ð²Ð¾Ð¹ Ð¿Ð¾ÑÑ (ÐœÐ¡Ðš = UTC+3)
timezoneOffset = 3

-- Ð˜Ð½Ñ‚ÐµÑ€Ð²Ð°Ð» ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸ (Ð¼Ñ) **ÑƒÑÑ‚Ð°Ñ€ÐµÐ»Ð¾** â€“ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ‚ÐµÐ¿ÐµÑ€ÑŒ Ñ‡ÐµÑ€ÐµÐ· GlobalState
syncInterval = 30000  -- legacy, Ð½Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ

-- ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ Ð²Ñ€ÐµÐ¼Ñ Ð² HUD
showInHud = true

-- Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ 24 Ñ‡Ð°ÑÐ°
format24h = true
```

## Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚Ñ‹

### Ð¡ÐµÑ€Ð²ÐµÑ€Ð½Ñ‹Ðµ
```lua
-- ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ñ‚ÐµÐºÑƒÑ‰ÐµÐµ Ð²Ñ€ÐµÐ¼Ñ
exports['qbx_gametime']:GetCurrentTime()
-- Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚: {hour = 12, minute = 30, second = 0}

-- ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ Ð´ÐµÐ½ÑŒ
exports['qbx_gametime']:GetCurrentDay()
-- Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚: dayNumber, dayName

-- ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ñ‚ÐµÐºÑƒÑ‰ÑƒÑŽ Ð¿Ð¾Ð³Ð¾Ð´Ñƒ
exports['qbx_gametime']:GetCurrentWeather()
-- Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚: "CLEAR"

-- Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð²Ñ€ÐµÐ¼Ñ
exports['qbx_gametime']:SetTime(hour, minute)
-- Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚: true/false
```

### ÐšÐ»Ð¸ÐµÐ½Ñ‚ÑÐºÐ¸Ðµ
```lua
-- ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ñ‚ÐµÐºÑƒÑ‰ÐµÐµ Ð²Ñ€ÐµÐ¼Ñ
exports['qbx_gametime']:GetCurrentTime()

-- ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ Ð´ÐµÐ½ÑŒ
exports['qbx_gametime']:GetCurrentDay()

-- ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ñ‚ÐµÐºÑƒÑ‰ÑƒÑŽ Ð¿Ð¾Ð³Ð¾Ð´Ñƒ
exports['qbx_gametime']:GetCurrentWeather()
```

## Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ñ

### Ð¡ÐµÑ€Ð²ÐµÑ€Ð½Ñ‹Ðµ/ÐšÐ»Ð¸ÐµÐ½Ñ‚ÑÐºÐ¸Ðµ
```lua
-- ÐŸÑ€Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¸ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ (ÐºÐ°Ð¶Ð´ÑƒÑŽ Ð¸Ð³Ñ€Ð¾Ð²ÑƒÑŽ Ð¼Ð¸Ð½ÑƒÑ‚Ñƒ)
RegisterNetEvent('qbx_gametime:timeChanged', function(hour, minute)
    print(string.format("Ð’Ñ€ÐµÐ¼Ñ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð»Ð¾ÑÑŒ: %02d:%02d", hour, minute))
end)

-- ÐŸÑ€Ð¸ ÑÐ¼ÐµÐ½Ðµ Ð´Ð½Ñ
RegisterNetEvent('qbx_gametime:dayChanged', function(dayNumber, dayName)
    print(string.format("ÐÐ¾Ð²Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ: %s", dayName))
end)

-- ÐŸÑ€Ð¸ ÑÐ¼ÐµÐ½Ðµ Ð¿Ð¾Ð³Ð¾Ð´Ñ‹
RegisterNetEvent('qbx_gametime:weatherChanged', function(current, next)
    print(string.format("ÐŸÐ¾Ð³Ð¾Ð´Ð° Ð¼ÐµÐ½ÑÐµÑ‚ÑÑ Ñ %s Ð½Ð° %s", current, next))
end)
```

## Callback

```lua
-- ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸
local timeData = lib.callback.await('qbx_gametime:getTimeData', false)
-- Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚:
-- {
--     time = {hour = 12, minute = 30, second = 0},
--     day = 1,
--     dayName = "ÐŸÐ¾Ð½ÐµÐ´ÐµÐ»ÑŒÐ½Ð¸Ðº",
--     weather = {current = "CLEAR", next = "CLOUDS", timer = 10}
-- }
```

## Ð¢Ð¸Ð¿Ñ‹ Ð¿Ð¾Ð³Ð¾Ð´Ñ‹

- `CLEAR` - Ð¯ÑÐ½Ð¾
- `CLOUDS` - ÐžÐ±Ð»Ð°Ñ‡Ð½Ð¾
- `OVERCAST` - ÐŸÐ°ÑÐ¼ÑƒÑ€Ð½Ð¾
- `RAIN` - Ð”Ð¾Ð¶Ð´ÑŒ
- `THUNDER` - Ð“Ñ€Ð¾Ð·Ð°
- `FOGGY` - Ð¢ÑƒÐ¼Ð°Ð½
- `SMOG` - Ð¡Ð¼Ð¾Ð³
- `SNOW` - Ð¡Ð½ÐµÐ³
- `BLIZZARD` - ÐœÐµÑ‚ÐµÐ»ÑŒ
- `SNOWLIGHT` - Ð›ÐµÐ³ÐºÐ¸Ð¹ ÑÐ½ÐµÐ³
- `XMAS` - Ð Ð¾Ð¶Ð´ÐµÑÑ‚Ð²Ð¾
- `HALLOWEEN` - Ð¥ÑÐ»Ð»Ð¾ÑƒÐ¸Ð½

## ÐŸÑ€Ð°Ð²Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°

ÐŸÐ¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ÑÑ ACE permissions:
```
add_ace group.admin qbx.admin allow
```

Ð˜Ð»Ð¸ Ð¼Ð¾Ð¶Ð½Ð¾ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑŒ Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ Ð² ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸:
```lua
adminPermissions = {
    allowedGroups = {'admin', 'god'},
    useAcePerms = false
}
```

## Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Ð´Ñ€ÑƒÐ³Ð¸Ð¼Ð¸ Ñ€ÐµÑÑƒÑ€ÑÐ°Ð¼Ð¸

### ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ð² Ð´Ñ€ÑƒÐ³Ð¾Ð¼ Ñ€ÐµÑÑƒÑ€ÑÐµ
```lua
-- ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ, Ð´ÐµÐ½ÑŒ Ð»Ð¸ ÑÐµÐ¹Ñ‡Ð°Ñ
local time = exports['qbx_gametime']:GetCurrentTime()
if time.hour >= 6 and time.hour < 20 then
    print("Ð¡ÐµÐ¹Ñ‡Ð°Ñ Ð´ÐµÐ½ÑŒ")
else
    print("Ð¡ÐµÐ¹Ñ‡Ð°Ñ Ð½Ð¾Ñ‡ÑŒ")
end

-- ÐŸÐ¾Ð´Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð½Ð° ÑÐ¼ÐµÐ½Ñƒ Ð´Ð½Ñ
RegisterNetEvent('qbx_gametime:dayChanged', function(dayNumber, dayName)
    if dayNumber == 6 or dayNumber == 7 then
        -- Ð’Ñ‹Ñ…Ð¾Ð´Ð½Ñ‹Ðµ (ÑÑƒÐ±Ð±Ð¾Ñ‚Ð°/Ð²Ð¾ÑÐºÑ€ÐµÑÐµÐ½ÑŒÐµ)
        -- ÐœÐ¾Ð¶Ð½Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð±Ð¾Ð½ÑƒÑÑ‹ Ð¸Ð»Ð¸ Ð¾ÑÐ¾Ð±Ñ‹Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ
    end
end)
```

## Ð›Ð¸Ñ†ÐµÐ½Ð·Ð¸Ñ

Ð­Ñ‚Ð¾Ñ‚ Ñ€ÐµÑÑƒÑ€Ñ Ñ€Ð°ÑÐ¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ Ð¿Ð¾Ð´ Ð»Ð¸Ñ†ÐµÐ½Ð·Ð¸ÐµÐ¹ MIT.